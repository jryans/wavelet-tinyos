
<html>
<head>
<title>Component: BroadcastM</title>
</head>
<body>
<table BORDER="0" CELLPADDING="3" CELLSPACING="0" width="100%">
<tr><td>
<font size="-1">
<b><font color="blue"><a href="apps_p.html">Apps</a></font></b>
&nbsp;&nbsp;&nbsp;
<b><a href="components_p.html">Components</a></b>
&nbsp;&nbsp;&nbsp;
<b><a href="interfaces_p.html">Interfaces</a></b>
&nbsp;&nbsp;&nbsp;
<b><a href="allfiles_p.html">All Files</a></b>
&nbsp;&nbsp;&nbsp;
<b><a href="index.html">Source Tree</a></b>
&nbsp;&nbsp;&nbsp;
</font>
</td>
<td align="right">
<font size="-1">
source: <b><a href="apps.compass.BroadcastM.nc.source">apps.compass.BroadcastM.nc</a></b>
</font>
</td></tr></table>
<hr>

<h1 align="center">Component: BroadcastM</h1>
<p>

 I converted the TinyOS library Bcast to a version that makes use of the
 Transceiver library and makes use of its queue abilities, rather than
 implementing another one of its own.
 TODO: Remove back-to-back repeats.  Simple idea: save message,
 repeat a few times with timers.  Use sounder if Tranceiver needs more
 message slots.
 From Ray: If you know neighbors, repeat bcasts until neighbors repeat
 them back to you (prob give up after N tries or M ms)
 <table border="0" cellpadding="0">
<tr valign="top"><td><b>Author:</b>
<td> Ryan Stinnett
</td></tr></table>

<p>

<table BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<tr BGCOLOR="#CCCCFF"><td>
<h3>Required Interfaces</h3></td></tr></table>
<ul>
<li>    <a href="tos.lib.Transceiver.Transceiver.nc.html">Transceiver</a> IO
<li>    <a href="tos.interfaces.Leds.nc.html">Leds</a> 
<li>    <a href="tos.interfaces.Timer.nc.html">Timer</a> Repeat
<li>    <a href="apps.compass.MoteOptions.nc.html">MoteOptions</a> 
</ul>

<table BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<tr BGCOLOR="#CCCCFF"><td>
<h3>Provided Interfaces</h3></td></tr></table>
<ul>
<li>    <a href="apps.compass.Message.nc.html">Message</a> 
</ul>

<table BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<tr BGCOLOR="#CCCCFF"><td>
<h3>Variables</h3></td></tr></table>
<ul>
<li>   int16_t bcastSeqno = 0
<li>   TOS_MsgPtr tmpPtr
<li>   bPack sendData
<li>   uint8_t curRepsLeft
<li>   uint8_t len = sizeof(bPack )
</ul>

<table BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<tr BGCOLOR="#CCCCFF"><td>
<h3>Function Index</h3></td></tr></table>
<ul>
<li>
        bool     <a href="#bool newBcast(int16_t proposed)">
<b>newBcast</b>    </a>
(int16_t proposed)
<menu> 
 This handles sequence space wrap-around.</menu><p>

<li>
        void <b>fwdBcast</b>(void)
<menu>
 Each unique broadcast wave is signaled to applications once, but
 may be rebroadcast multiple times to ensure reception.
</menu><p>

<li>
        TOS_MsgPtr <b>receive</b>(TOS_MsgPtr pMsg)
<menu>
 All received messages come here, since the medium is unimportant.
</menu><p>

<li>
        event result_t     <a href="tos.interfaces.Timer.nc.html#event result_t Repeat.fired(void)">
<b>Repeat.fired</b>    </a>
(void)
<menu>
 After a delay of BCAST_REP_DELAY bms, a broadcast message
 is repeat to ensure neighbors receive it.
</menu><p>

<li>
        command result_t     <a href="apps.compass.Message.nc.html#command result_t Message.send(msgData msg)">
<b>Message.send</b>    </a>
(msgData msg)
<menu>
 Sends message data to the network
 TODO: Can't initiate broadcasts on a mote yet.
</menu><p>

<li>
        event result_t     <a href="#event result_t IO.radioSendDone(TOS_MsgPtr m, result_t result)">
<b>IO.radioSendDone</b>    </a>
(TOS_MsgPtr m, result_t result)
<menu>
 A message was sent over radio.
</menu><p>

<li>
        event result_t     <a href="#event result_t IO.uartSendDone(TOS_MsgPtr m, result_t result)">
<b>IO.uartSendDone</b>    </a>
(TOS_MsgPtr m, result_t result)
<menu>
 A message was sent over UART.
</menu><p>

<li>
        event TOS_MsgPtr     <a href="#event TOS_MsgPtr IO.receiveRadio(TOS_MsgPtr m)">
<b>IO.receiveRadio</b>    </a>
(TOS_MsgPtr m)
<menu>
 Received a message over the radio
</menu><p>

<li>
        event TOS_MsgPtr     <a href="#event TOS_MsgPtr IO.receiveUart(TOS_MsgPtr m)">
<b>IO.receiveUart</b>    </a>
(TOS_MsgPtr m)
<menu>
 Received a message over UART
</menu><p>

<li>
        event void     <a href="apps.compass.MoteOptions.nc.html#event void MoteOptions.receive(uint8_t optMask, uint8_t optValue)">
<b>MoteOptions.receive</b>    </a>
(uint8_t optMask, uint8_t optValue)
<menu>
 Signaled when an option affecting other applications is received.
</menu><p>

</ul>

<table BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<tr BGCOLOR="#CCCCFF"><td>
<h3>Function Descriptions</h3>
</td></tr></table>
    <a name="bool newBcast(int16_t proposed)"></a>
        <h4>newBcast</h4>
        bool <b>newBcast</b>(int16_t proposed)<P><menu> 
 This handles sequence space wrap-around. Overlow/Underflow makes
 the result below correct ( -, 0, + ) for any a, b in the sequence
 space. Results:	result	implies
			  - 	 a < b
			  0 	 a = b
			  + 	 a > b
</menu><hr>
    <a name="event result_t IO.radioSendDone(TOS_MsgPtr m, result_t result)"></a>
        <h4>IO.radioSendDone</h4>
        event result_t     <a href="tos.lib.Transceiver.Transceiver.nc.html#event result_t IO.radioSendDone(TOS_MsgPtr m, result_t result)"><b>IO.radioSendDone</b>    </a>
(TOS_MsgPtr m, result_t result)<P><menu>
 A message was sent over radio.
 <table border="0" cellpadding="0">
</td></tr>
<tr valign="top"><td><br><b>Parameters:</b></td>
<td><menu><p STYLE="text-indent: -1cm"><b>m</b> -  - a pointer to the sent message, valid for the duration of the 
     event.
 </p><p STYLE="text-indent: -1cm"><b>result</b> -  - SUCCESS or FAIL.
</menu></menu>
</td></tr></table>
</menu><hr>
    <a name="event result_t IO.uartSendDone(TOS_MsgPtr m, result_t result)"></a>
        <h4>IO.uartSendDone</h4>
        event result_t     <a href="tos.lib.Transceiver.Transceiver.nc.html#event result_t IO.uartSendDone(TOS_MsgPtr m, result_t result)"><b>IO.uartSendDone</b>    </a>
(TOS_MsgPtr m, result_t result)<P><menu>
 A message was sent over UART.
 <table border="0" cellpadding="0">
</td></tr>
<tr valign="top"><td><br><b>Parameters:</b></td>
<td><menu><p STYLE="text-indent: -1cm"><b>m</b> -  - a pointer to the sent message, valid for the duration of the 
     event.
 </p><p STYLE="text-indent: -1cm"><b>result</b> -  - SUCCESS or FAIL.
</menu></menu>
</td></tr></table>
</menu><hr>
    <a name="event TOS_MsgPtr IO.receiveRadio(TOS_MsgPtr m)"></a>
        <h4>IO.receiveRadio</h4>
        event TOS_MsgPtr     <a href="tos.lib.Transceiver.Transceiver.nc.html#event TOS_MsgPtr IO.receiveRadio(TOS_MsgPtr m)"><b>IO.receiveRadio</b>    </a>
(TOS_MsgPtr m)<P><menu>
 Received a message over the radio
 <table border="0" cellpadding="0">
</td></tr>
<tr valign="top"><td><br><b>Parameters:</b></td>
<td><menu><p STYLE="text-indent: -1cm"><b>m</b> -  - the receive message, valid for the duration of the 
     event.
</menu></menu>
</td></tr></table>
</menu><hr>
    <a name="event TOS_MsgPtr IO.receiveUart(TOS_MsgPtr m)"></a>
        <h4>IO.receiveUart</h4>
        event TOS_MsgPtr     <a href="tos.lib.Transceiver.Transceiver.nc.html#event TOS_MsgPtr IO.receiveUart(TOS_MsgPtr m)"><b>IO.receiveUart</b>    </a>
(TOS_MsgPtr m)<P><menu>
 Received a message over UART
 <table border="0" cellpadding="0">
</td></tr>
<tr valign="top"><td><br><b>Parameters:</b></td>
<td><menu><p STYLE="text-indent: -1cm"><b>m</b> -  - the receive message, valid for the duration of the 
     event.
</menu></menu>
</td></tr></table>
</menu>